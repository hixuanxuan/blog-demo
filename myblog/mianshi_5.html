<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>异步 | Xuanxuan&#39;s blog</title>
    <meta name="description" content="我的个人网站">
    <link rel="icon" href="./rabbit.png">
    
    <link rel="preload" href="/blog-demo/assets/css/0.styles.a4c10295.css" as="style"><link rel="preload" href="/blog-demo/assets/js/app.1d89a26a.js" as="script"><link rel="preload" href="/blog-demo/assets/js/2.e056be92.js" as="script"><link rel="preload" href="/blog-demo/assets/js/15.8c2f0fd5.js" as="script"><link rel="prefetch" href="/blog-demo/assets/js/10.4bdca461.js"><link rel="prefetch" href="/blog-demo/assets/js/11.f3631a30.js"><link rel="prefetch" href="/blog-demo/assets/js/12.3baef48e.js"><link rel="prefetch" href="/blog-demo/assets/js/13.9da9935f.js"><link rel="prefetch" href="/blog-demo/assets/js/14.eeaa6772.js"><link rel="prefetch" href="/blog-demo/assets/js/16.6f1b9cd3.js"><link rel="prefetch" href="/blog-demo/assets/js/17.a21e6f1b.js"><link rel="prefetch" href="/blog-demo/assets/js/18.9a0a4250.js"><link rel="prefetch" href="/blog-demo/assets/js/19.94c67f3b.js"><link rel="prefetch" href="/blog-demo/assets/js/20.aff2ca1c.js"><link rel="prefetch" href="/blog-demo/assets/js/21.e5295bc9.js"><link rel="prefetch" href="/blog-demo/assets/js/22.74b3cda7.js"><link rel="prefetch" href="/blog-demo/assets/js/23.9cb487fb.js"><link rel="prefetch" href="/blog-demo/assets/js/24.6e8dd019.js"><link rel="prefetch" href="/blog-demo/assets/js/25.1d8f9bed.js"><link rel="prefetch" href="/blog-demo/assets/js/26.40eae98a.js"><link rel="prefetch" href="/blog-demo/assets/js/27.b7aaa278.js"><link rel="prefetch" href="/blog-demo/assets/js/28.53c77287.js"><link rel="prefetch" href="/blog-demo/assets/js/29.1f3af06f.js"><link rel="prefetch" href="/blog-demo/assets/js/3.a70938db.js"><link rel="prefetch" href="/blog-demo/assets/js/30.5f5b1d34.js"><link rel="prefetch" href="/blog-demo/assets/js/31.3a9b3f3a.js"><link rel="prefetch" href="/blog-demo/assets/js/32.e00d4b9b.js"><link rel="prefetch" href="/blog-demo/assets/js/33.39317c8a.js"><link rel="prefetch" href="/blog-demo/assets/js/34.f1a0629c.js"><link rel="prefetch" href="/blog-demo/assets/js/35.b9538080.js"><link rel="prefetch" href="/blog-demo/assets/js/36.2d204a03.js"><link rel="prefetch" href="/blog-demo/assets/js/37.b72bb3d1.js"><link rel="prefetch" href="/blog-demo/assets/js/38.6a4765f0.js"><link rel="prefetch" href="/blog-demo/assets/js/39.76f36664.js"><link rel="prefetch" href="/blog-demo/assets/js/4.0f3eb812.js"><link rel="prefetch" href="/blog-demo/assets/js/40.cb590e60.js"><link rel="prefetch" href="/blog-demo/assets/js/41.6ce6059a.js"><link rel="prefetch" href="/blog-demo/assets/js/42.949c19e3.js"><link rel="prefetch" href="/blog-demo/assets/js/43.67e1bd45.js"><link rel="prefetch" href="/blog-demo/assets/js/44.c4e0b23d.js"><link rel="prefetch" href="/blog-demo/assets/js/45.4f7fee8b.js"><link rel="prefetch" href="/blog-demo/assets/js/46.0f5696db.js"><link rel="prefetch" href="/blog-demo/assets/js/47.b5d59a1d.js"><link rel="prefetch" href="/blog-demo/assets/js/48.f519ab65.js"><link rel="prefetch" href="/blog-demo/assets/js/5.d6f30415.js"><link rel="prefetch" href="/blog-demo/assets/js/6.5f6ad1ed.js"><link rel="prefetch" href="/blog-demo/assets/js/7.94c09ca7.js"><link rel="prefetch" href="/blog-demo/assets/js/8.16be45ff.js"><link rel="prefetch" href="/blog-demo/assets/js/9.6d10ac90.js">
    <link rel="stylesheet" href="/blog-demo/assets/css/0.styles.a4c10295.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-demo/" class="home-link router-link-active"><!----> <span class="site-name">Xuanxuan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-demo/accumulate/" class="nav-link">前端基础</a></div><div class="nav-item"><a href="/blog-demo/algorithm/" class="nav-link">算法题库</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-demo/accumulate/" class="nav-link">前端基础</a></div><div class="nav-item"><a href="/blog-demo/algorithm/" class="nav-link">算法题库</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog-demo/" class="sidebar-link">简介</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>知识点整理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog-demo/myblog/mianshi_1.html" class="sidebar-link">ES6语法</a></li><li><a href="/blog-demo/myblog/mianshi_2.html" class="sidebar-link">原型</a></li><li><a href="/blog-demo/myblog/mianshi_3.html" class="sidebar-link">virtual dom</a></li><li><a href="/blog-demo/myblog/mianshi_4.html" class="sidebar-link">MVVM</a></li><li><a href="/blog-demo/myblog/mianshi_5.html" class="active sidebar-link">异步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/myblog/mianshi_5.html#异步" class="sidebar-link">异步</a></li></ul></li><li><a href="/blog-demo/myblog/mianshi_6.html" class="sidebar-link">组件化</a></li><li><a href="/blog-demo/myblog/mianshi_7.html" class="sidebar-link">Hybrid</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react源码简单阅读</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>考点</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="异步"><a href="#异步" class="header-anchor">#</a> 异步</h2> <h3 id="_1-什么是单线程，和异步什么关系？"><a href="#_1-什么是单线程，和异步什么关系？" class="header-anchor">#</a> 1. 什么是单线程，和异步什么关系？</h3> <h4 id="_1-1-概念"><a href="#_1-1-概念" class="header-anchor">#</a> 1.1 概念</h4> <ul><li>单线程，只有一个线程，同一时间只能做一件事</li> <li>原因：避免dom渲染的冲突</li> <li>解决方案：异步</li></ul> <h4 id="_1-2-js单线程的原因"><a href="#_1-2-js单线程的原因" class="header-anchor">#</a> 1.2 js单线程的原因</h4> <ul><li>浏览器需要渲染DOM</li> <li>JS可以修改DOM的结构</li> <li>JS执行的时候，浏览器DOM渲染会暂停</li> <li>两段js也不能同时进行（都修改了DOM就冲突了）</li> <li>web worker支持多线程，但是不可以访问DOM</li></ul> <h4 id="_1-3-解决方案"><a href="#_1-3-解决方案" class="header-anchor">#</a> 1.3 解决方案</h4> <p>异步。在等待的时间不会阻塞，会执行其他事情。</p> <h3 id="_2-什么是event-loop"><a href="#_2-什么是event-loop" class="header-anchor">#</a> 2. 什么是event loop</h3> <h4 id="_2-1-文字解释"><a href="#_2-1-文字解释" class="header-anchor">#</a> 2.1. 文字解释</h4> <ul><li>事件轮询，JS实现异步的具体解决方案。</li> <li>同步代码，直接执行。</li> <li>异步函数优先放在异步队列中（setTimeout的要等setTimeout的时间到了才能放到队列，ajax的等ajax响应结束放到异步队列）。</li> <li>待同步函数执行完毕，轮询执行异步队列的函数。</li></ul> <h3 id="_3-是否用过jquery的deferred"><a href="#_3-是否用过jquery的deferred" class="header-anchor">#</a> 3. 是否用过jQuery的Deferred</h3> <p>$.ajax('./data.json').done(function(){}).fail(function(){}).done(function(){}).fail(()=&gt;{})
或者
$.ajax('./data.json').then(function(){},function(){}).then(function(){},function(){})
十分像Promise,传入两个参数，成功的回调和失败的回调。
JQUERY 1.5的变化。</p> <ul><li>无法改变JS异步和单线程的本质</li> <li>只能从写法上杜绝callback的这种形式</li> <li>他是一种语法糖形式，但是解耦合了代码。</li> <li>很好的体现了，开放封闭原则（对扩展开放，对修改封闭）。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">waitHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 创建一个deffered对象</span>
        <span class="token keyword">var</span> dtd<span class="token operator">=</span>$<span class="token punctuation">.</span><span class="token function">Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token function-variable function">wait</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dtd</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> <span class="token function-variable function">task</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                dtd<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//异步任务已经成功完成</span>
                <span class="token comment">//dtd.reject();//失败</span>
            <span class="token punctuation">}</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> dtd<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 注意，这里一定要有返回值</span>
        <span class="token keyword">return</span> <span class="token function">wait</span><span class="token punctuation">(</span>dtd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> w<span class="token operator">=</span><span class="token function">waitHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'no'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>总结：</p> <ul><li>dtd的API可以分为两类，用意不同。</li> <li>第一类，dtd.resolve() dtd.reject();系统主动操作</li> <li>dtd.then() dtd.done() dtd.fail()。.then()是被动监听then包括后面两个api。（这两类api应该分开，如果程序员主动执行dtd.reject()就可以把原本成功的变成不成功，后果很严重）</li></ul> <p>为了解决上面的问题，在JQuery1.5的时候有了改进。
不是直接返回deferred对象，返回return dtd.promise();
$.when(w).then(()=&gt;{
console.log('ok')
},()=&gt;{
console.log('no')
}).then(()=&gt;{
console.log('ok2')
})
之后如果直接执行w.reject()会报错，封装了一下返回promise只允许被动监听，不允许主动修改，不允许外部直接调用。更加接近promise</p> <h3 id="_4-pronise的基本使用和原理"><a href="#_4-pronise的基本使用和原理" class="header-anchor">#</a> 4. Pronise的基本使用和原理</h3> <h4 id="_4-1-基础语法"><a href="#_4-1-基础语法" class="header-anchor">#</a> 4.1 基础语法</h4> <p>我们想要加载完图片之后再请求另外的东西，加载图片的函数需要返回Promise对象，这样我们才能用.then控制异步的顺序，然后在Promise对象的内部，我们执行异步的加载操作，加载成功之后执行resolve；如果失败执行reject。</p> <h4 id="_4-2-异常捕获"><a href="#_4-2-异常捕获" class="header-anchor">#</a> 4.2 异常捕获</h4> <p>为了程序的健壮性，必不可少。在多个then的最后使用.catch捕获异常，
程序执行中，语法的报错，比如throw new Error('xxx');
另外一种，请求异常等逻辑错误。</p> <h4 id="_4-3-多个串联"><a href="#_4-3-多个串联" class="header-anchor">#</a> 4.3 多个串联</h4> <p>场景：我们需要加载图片1之后再加载图片2。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> img<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> promise<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            img<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            img<span class="token punctuation">.</span>src<span class="token operator">=</span>src<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> src1<span class="token operator">=</span><span class="token string">'https://dss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1694681277,1453280371&amp;fm=26&amp;gp=0.jpg'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> src2<span class="token operator">=</span><span class="token string">'https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1583176444135&amp;di=6114847e68cae3ae657c6a80bda808cc&amp;imgtype=0&amp;src=http%3A%2F%2Fa0.att.hudong.com%2F78%2F52%2F01200000123847134434529793168.jpg'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result1<span class="token operator">=</span><span class="token function">loadImage</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result2<span class="token operator">=</span><span class="token function">loadImage</span><span class="token punctuation">(</span>src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一个图片加载完成！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token operator">+</span>img1<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result2<span class="token punctuation">;</span><span class="token comment">//注意如果不返回result2那.then还是result1的.then,将拿到undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二个图片加载完成！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'img2'</span><span class="token operator">+</span>img2<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>串联操作瑶注意.then是谁的，注意上一个then的返回值。</p> <h4 id="_4-4-promise-all和promise-race"><a href="#_4-4-promise-all和promise-race" class="header-anchor">#</a> 4.4 Promise.all和Promise.race</h4> <p>Promise.all的回调函数的参数data是个数组，所有异步的返回值合在一起的数组，Promise.race是有一个执行好了就去执行回调了，所以回调函数是一个</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result1<span class="token punctuation">,</span>result2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result1<span class="token punctuation">,</span>result2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_4-5-promise标准"><a href="#_4-5-promise标准" class="header-anchor">#</a> 4.5 Promise标准</h4> <p>三种状态，pending,fullfill,rejected
初始是pending，初始-》成功或者初始-》失败，不可逆。Promise实例必须实现.then方法，.then()必须可以接受两个函数作为参数，.then()返回的必须是Promise实例。如果then里面没有明文返回promise实例，那她返回的就是本身(如果没有返回值，那下一个then的参数就是undefined，如果有返回值，那下一个then的参数就是返回值),如果返回值是一个promise实例，后面的then相当于是返回的promise实例的then。</p> <h3 id="_5-介绍一下async-await-和promise的区别联系"><a href="#_5-介绍一下async-await-和promise的区别联系" class="header-anchor">#</a> 5. 介绍一下async/await(和Promise的区别联系)</h3> <p>使用await，函数必须用async标识，await后面必须跟promise实例，
需要babel-polyfill，兼容；
async/await使用了Promise，但是没有和Promise冲突；完全是同步的写法，再也没有回调函数；但是改变不了JS单线程、异步的本质。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> result1<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>src1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> result2<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>src2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-总结一下当前js解决异步的方案"><a href="#_6-总结一下当前js解决异步的方案" class="header-anchor">#</a> 6. 总结一下当前JS解决异步的方案</h3> <ul><li>jquery deferred</li> <li>Promise</li> <li>async/await</li> <li>generator</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-demo/myblog/mianshi_4.html" class="prev">MVVM</a></span> <span class="next"><a href="/blog-demo/myblog/mianshi_6.html">组件化</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog-demo/assets/js/app.1d89a26a.js" defer></script><script src="/blog-demo/assets/js/2.e056be92.js" defer></script><script src="/blog-demo/assets/js/15.8c2f0fd5.js" defer></script>
  </body>
</html>
